---
tags:
  - テスト
---

# ソフトウェアテストを学ぶ

「知識ゼロから学ぶソフトウェアテスト」

成果物の品質を上げたいと思い、テストについてまとめられた書籍を購入した

書籍を読んで、要約、自分が感じたこと等をまとめる

## テスト担当者の心得

`バグを全部見つけるのは無理だと心得ろ`

* ソフトウェアには無数のバグが潜在し、ゼロにするのは難しい
* 優先順位を設け、品質に致命的なバグを潰す

`エラーは見つからないだろうというい設定のもとにテストの計画を立ててはいけない`

* 車の運転と同じで、エラーはないだろうと思うとバグを見逃す
* 常にバグがあるかもしれないという姿勢でテストに臨むべし

`プログラムのある部分でエラーがまだ存在している確率は、すでにその部分で見つかったエラーの数に比例する`

* バグはプログラムの特定の部分に偏在している（バグの47%はプログラムの4%の部分に偏在しているという例）
* 複雑なプログラムの箇所でバグが見つかったらなら、まだ別のバグが残っているかもしれないと考えた方が良い

`ソフトウェアテストで重要なのは、どの部分にバグが出やすいのか、そこにどのような手法を適用すれば十分な品質が得られるかを知ることである`

## 完全無欠なソフトウェアテストは可能か？

* まったくバグのないソフトウェアは存在しない
* 「完璧」ではなくとも「十分」な品質を持つソフトウェアは効果的なテストで実現できる

`品質向上のための投資は、投資額が修正にかかる費用を超過するか、「もっとましなことをすべきだ」と誰かが言い出すまで増加しつづける`

`テストケースを書くことはプログラムを書くよりも難しい`

## ホワイトボックステスト

* 「どのテスト手法を適用すべきなのか」を常によく考える
* 限りある時間の中で効率的にテストを実行する

`ホワイトボックステストは論理構造の正しさのみをテストするため、ソフトウェアの仕様が間違っていることから起こるバグは発見できない`

### 制御パステスト法

* プログラムがどのような振る舞いをして、どのように制御され実行されていくかをテストする
* 制御パステストによるコードカバレッジテストの本質は、様々に分岐するフローチャートをきちんとカバーすることにある

`ステートメントカバレッジ`

ステートメントカバレッジは、コード内の命令文（ステートメント）を少なくとも一回は実行する

ステートメントカバレッジでは、`a > 1`が`true`となるケースを1回実行することでテストを終了するため、`a == 0`などのパスが抜ける非常に弱いテスト手法

また、そもそも`if a > 1`の部分を`if a > 0`と書いてしまった場合のバグは発見できない

```mermaid
graph TB
   A[Start] --> B{if a > 1};
   B -->|Yes| C[A];
   B -->|No| D[B];
```

`ブランチカバレッジ`

ブランチカバレッジは、分岐コードに対して`true`と`false`の結果を少なくとも一回ずつ持つようにテストケースを実行する

* テストケースの数が増大する
* ある特定のバグが発生しやすい部分にブランチカバレッジを実行するのが効果的

### カバレッジ基準

カバレッジ基準とは、テストがどれだけ網羅されているかを示す基準値

* 一般の商用ソフトウェアなら60~90%程度で十分
* カバレッジ測定せずに出荷するのはリスクの高い行為
* カバレッジの値が高いから絶対に大丈夫とは言えない

Visual Studioにもコードカバレッジ分析の機能はあるが`Visual Studio Enterprise`に限定されている

nugetで提供されているC#用の分析ツール

* [Coverlet](https://www.nuget.org/packages/coverlet.console) カバレッジ測定ツール
* [ReportGenerator](https://www.nuget.org/packages/ReportGenerator) レポート出力ツール

カバレッジテストで検出できないバグ

* プログラムのループに関するバグ
* 要求仕様自体が間違っていたり、機能が備わっていないバグ
* データに起因するバグ
* タイミングに起因するバグ

プログラムのループに関するテストケース

* ループをしない、ループ自体がスキップされるケース
* ループ回数が1回のケース
* 典型的なループ回数のケース
* 最大ループ回数より1少ない数でのケース
* 最大ループ回数でのケース
* 最大ループ回数 + 1でのケース

要求仕様自体が間違っていたり、機能が備わっていないバグ

* 仕様自体が間違っていても、テストでバグを検出できない
* 機能自体がごっそり抜け落ちていても検出できないので、要求仕様書をテスト仕様書と付き合わせてチェックする必要がある

データに起因するバグ

* `mutex`等、複数のプログラム（タスク）が同時に処理を行う環境（並列処理）で、共有資源に対して同時にアクセスしても問題がないようにする
* データベースの中身が変化することでバグが出たり、出なかったりするケース

タイミング（マルチタスクや割り込み）に起因するバグ

* データがプロセス・スレッド間で共有されているかをチェックする
* 共有されているデータへのアクセスパターンをテストケースに落とし込む
* プロセス・スレッドの生成と削減の組み合わせをテストする
* できるだけたくさんのプロセスとスレッドを立ち上げてテストする

## Reference
* [単体テストにコードカバレッジを使用する](https://learn.microsoft.com/ja-jp/dotnet/core/testing/unit-testing-code-coverage?tabs=linux)
* [coverlet.console](https://www.nuget.org/packages/coverlet.console)
* [ReportGenerator](https://www.nuget.org/packages/ReportGenerator)
